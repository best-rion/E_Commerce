{% extends "user_layout.html" %}


{% block content %}

<div class="container py-5">

    <table class="table table-striped table-success my-5">

        <thead>
            <tr class="text-center">
                <th scope="col">Sl No.</th>
                <th scope="col">Name</th>
                <th scope="col">Detail</th>
                <th scope="col">Price</th>
                <th scope="col">Qty</th>
                <th scope="col"></th>
            </tr>
        </thead>

        <tbody>
            {% for product in products %}
            <tr id="divLink" class="text-center">
                <td scope="row">{{loop.index}}</td>
                <td>{{ product.name }}</td>
                <td>{{ product.detail }}</td>
                <td>{{ product.price }}</td>
                <td>
                    <div class="d-flex" style="align-items: center; justify-content: center;">
                        <form id="minus-{{ loop.index }}">
                            <input type="text" name="sign" value="-" hidden>
                            <input type="text" name="index" value="{{loop.index}}" hidden>
                            <input type="submit" value="-" class="btn btn-light me-2">
                        </form>

                        <span id="qty-{{ loop.index }}">{{ quantity_list[loop.index-1] }}</span>

                        <form id="plus-{{ loop.index }}">
                            <input type="text" name="sign" value="+" hidden>
                            <input type="text" name="index" value="{{loop.index}}" hidden>
                            <input type="submit" value="+" class="btn btn-light ms-2">
                        </form>
                    </div>
                </td>
                <td>
                    <form action="{{ url_for('users.deleteInCart', index=loop.index)}}" method="post">
                        <input type="submit" value="Remove" class="btn btn-danger">
                    </form>
                </td>
            </tr>

            <script>

                $(document).ready(function () {
                    $('#plus-{{ loop.index }}').submit(function (event) {
                        event.preventDefault();
                        $.ajax({
                            type: 'POST',
                            url: "{{url_for('users.actionInCart')}}",
                            data: $('#plus-{{ loop.index }}').serialize(),
                            success: function () {

                                $quantity = parseInt($('#qty-{{loop.index}}').text()) + 1

                                $('#qty-{{loop.index}}').html($quantity.toString())




                                // increasing items in the top cart

                                $numberOfItems = parseInt($('#numberOfItems').text()) + 1

                                $('#numberOfItems').html($numberOfItems.toString())
                            }
                        });
                    });
                });

                $(document).ready(function () {
                    $('#minus-{{ loop.index }}').submit(function (event) {
                        event.preventDefault();
                        $.ajax({
                            type: 'POST',
                            url: "{{url_for('users.actionInCart')}}",
                            data: $('#minus-{{ loop.index }}').serialize(),
                            success: function () {

                                $quantity = parseInt($('#qty-{{loop.index}}').text()) - 1

                                if ($quantity >= 0) {

                                    $('#qty-{{loop.index}}').html($quantity.toString())


                                    // decreasing items in the top cart
                                    $numberOfItems = parseInt($('#numberOfItems').text()) - 1

                                    $('#numberOfItems').html($numberOfItems.toString())
                                }
                            }
                        });
                    });
                });
            </script>

            {% endfor %}

        </tbody>

    </table>
</div>

{% endblock %}